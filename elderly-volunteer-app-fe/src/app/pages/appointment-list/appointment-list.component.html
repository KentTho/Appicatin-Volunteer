<div class="container">
  <div class="sidebar">
    <app-sidebar></app-sidebar>
  </div>
  <div class="appointment-list-container">
    <h2>ğŸ“… Danh SÃ¡ch Lá»‹ch Háº¹n</h2>

    <p class="error" *ngIf="errorMessage">{{ errorMessage }}</p>

    <!-- ğŸŸ¢ Bá»™ lá»c ngÃ y -->
    <div class="filter">
      <label for="filterDate">ğŸ“… Lá»c theo ngÃ y:</label>
      <input type="date" id="filterDate" (change)="onDateChange($event)" />
    </div>

    <div *ngIf="appointments.length === 0 && !errorMessage" class="empty-state">
      ğŸ“­ Báº¡n chÆ°a cÃ³ lá»‹ch háº¹n nÃ o.
    </div>

    <div class="appointment-card" *ngFor="let appointment of appointments">
      <p>
        <strong>â° NgÃ y:</strong>
        {{ appointment.date | date : "dd/MM/yyyy HH:mm" }}
      </p>
      <p>
        <strong>ğŸ‘´ NgÆ°á»i Cao Tuá»•i:</strong> {{ appointment.elderlyId.name }}
      </p>
      <p>
        <strong>ğŸ¤ TÃ¬nh Nguyá»‡n ViÃªn:</strong> {{ appointment.volunteerId.name }}
      </p>
      <p><strong>ğŸ“œ Ghi ChÃº:</strong> {{ appointment.notes || "KhÃ´ng cÃ³" }}</p>
      <p>
        <strong>ğŸ“Œ Tráº¡ng ThÃ¡i:</strong>
        <span [class]="appointment.status">{{
          getStatusLabel(appointment.status)
        }}</span>
      </p>

      <!-- ğŸŸ¢ Náº¿u cuá»™c háº¹n lÃ  'pending', Volunteer cÃ³ thá»ƒ xÃ¡c nháº­n -->
      <button
        *ngIf="appointment.status === 'pending' && isVolunteer()"
        class="btn-confirm"
        (click)="confirmAppointment(appointment._id)"
      >
        âœ… XÃ¡c nháº­n
      </button>

      <!-- ğŸ”µ Náº¿u cuá»™c háº¹n lÃ  'confirmed', Elderly cÃ³ thá»ƒ hoÃ n thÃ nh -->
      <button
        *ngIf="appointment.status === 'confirmed' && isElderly()"
        class="btn-complete"
        (click)="completeAppointment(appointment._id)"
      >
        ğŸ¯ HoÃ n thÃ nh
      </button>

      <!-- ğŸ”´ Náº¿u cuá»™c háº¹n lÃ  'pending', hiá»ƒn thá»‹ nÃºt há»§y -->
      <button
        *ngIf="appointment.status === 'pending'"
        class="btn-cancel"
        (click)="cancelAppointment(appointment._id)"
      >
        âŒ Há»§y
      </button>

      <!-- â­ Náº¿u cuá»™c háº¹n Ä‘Ã£ Ä‘Æ°á»£c hoÃ n thÃ nh, Elderly cÃ³ thá»ƒ Ä‘Ã¡nh giÃ¡ -->
      <div
        *ngIf="
          isElderly() &&
          appointment.status === 'completed' &&
          !appointment.rating
        "
      >
        <label>â­ ÄÃ¡nh giÃ¡:</label>
        <input
          type="number"
          min="1"
          max="5"
          [(ngModel)]="ratingData[appointment._id].rating"
          placeholder="Nháº­p sá»‘ sao (1-5)"
        />
        <textarea
          [(ngModel)]="ratingData[appointment._id].comment"
          placeholder="Viáº¿t nháº­n xÃ©t..."
        ></textarea>
        <button (click)="rateAppointment(appointment._id)">Gá»­i Ä‘Ã¡nh giÃ¡</button>
      </div>

      <!-- ğŸ† Náº¿u Ä‘Ã£ Ä‘Ã¡nh giÃ¡, hiá»ƒn thá»‹ Ä‘Ã¡nh giÃ¡ -->
      <div *ngIf="appointment.rating">
        <p><strong>ğŸ“Œ ÄÃ¡nh giÃ¡:</strong> {{ appointment.rating }} â­</p>
        <p>
          <strong>ğŸ’¬ Nháº­n xÃ©t:</strong>
          {{ appointment.comment || "KhÃ´ng cÃ³ nháº­n xÃ©t" }}
        </p>
      </div>
    </div>

    <button class="btn-back" (click)="goHome()">ğŸ  Quay láº¡i</button>
  </div>
</div>
